{"title":"Lab 3","markdown":{"yaml":{"title":"Lab 3","subtitle":"Philadelphia Housing Price Prediction Improving Property Tax Assessments","author":"Ixchel Ramirez","format":{"revealjs":{"theme":"simple","slide-number":true,"smaller":true}}},"headingText":"Choices for data cleaning","containsRefs":false,"markdown":"\n\n---\n\n\nBefore starting the analysis it is necessary to clean each of the datasets to remove anomalies like houses with no rooms. Although we were looking at residential properties we did not include apartment building as it assigned the sale price of each apartment as the sale price of the building so this was removed. Hence, we are left with homes which mean they will include rooms. We also removed residential locations with sale prices under 10000 or over 1000000 which are very low and high prices and isolated parcel data to data between 2023 and 2024. Census data cleaning involved removing data errors or incomplete fields and adding a column to reflect percentages. The Census data started off with 408 rows and ended with 383 after the cleaning choices.\nOther data that is also included is university and college locations, crime locations and neighborhood. These are cleaned in a later portion and involve transforming the coordinate reference system so that everything corresponds before filtering and re-categorizing data to help with interpretation \n\n---\n\n### Phase 2: Exploratory Data Analysis\n\n![](figures/phl_sale_price_distribution.png){fig-align=\"center\"}\n\nThe graph above shows the highest concentration of parcel sale prices is around\" $200,000. The histogram is right-skewed which means most sale prices are concentrated on the left side between zero and $375,000. In such a case the mean is generally greater than the median because the tail  on the right could inflate the mean. This affects the model's prediction for lower income homes. \n\n---\n\n### Geographic distribution\n\n![](figures/phl_sale_price_map.png){fig-align=\"center\"}\n\n---\n\n**Geographic distribution**\nThe geographic distribution of sale prices in Philadelphia shows that the most expensive sales were around Center City, North West Philadelphia and North East Philadelphia Airport.The lowest sales are in South and North Philadelphia. There is little transition from areas with a high sale price to areas with a low sale price.\n\n---\n\n### Price vs. structural features \n![](figures/phl_price_vs_area.png){fig-align=\"center\"}\n\nMost places have a total livable area under 3000 sq ft, by 4000 sq ft the number is very sparce. Since the maximum for sale price is capped at **$** 1,000,000 there is a hard stop at this point on the y-axis. The most common type of sale was between zero to $500,000 for 0 to 2000 total livable square feet.\n\n---\n\n![](figures/phl_price_vs_bathrooms.png){fig-align=\"center\"}\nWith respect to bathrooms the parcel that is sold the most contains 2 bathrooms and sales for under $812,500.\n\n---\n\n![](figures/phl_price_vs_bedrooms.png){fig-align=\"center\"}\n\nThe parcel that is sold the most contains 2 bathrooms and sales for under $750,000.\n\n---\n \n### Price vs. spatial features\n![](figures/phl_price_vs_college_distance.png){fig-align=\"center\"}\nThe Sale Price vs Distance to Nearest College Map shows that as parcels are further from colleges their sale price decreases slightly due to the slight negative slope of the line. \n\n---\n\n### Creative visualization\n![](figures/density map-1.png){fig-align=\"center\"}\nMost areas have 2 bedrooms but there are several pockets such as slightly North of Center City and West Philadelphia which have a higher number of bedrooms.\n\n---\n\n### Phase 3: Feature Engineering\n\n1. **Buffer-based features**:\n\n   - Violent Crimes within 600ft\n\n2. **k-Nearest Neighbor features**:\n\n   - Average distance from parcel to 1, 3, and 5 nearest colleges and university buildings. Code written above in order to map feature.\n   \n3. **Census variables**:\n\n   - Join median income, percentage with a bachelor's degree, and poverty percentage \n\n4. **Interaction terms**:\n\n   - Wealthy neighborhoods which take into account if a home is in a wealthy neighborhood which is based on median sale price.\n   \n5. **Other features**:\n\n   - log_sale_price, log_livable_area, age and exterior condition (if it is good or not)\n\n---\n\n### Interaction effects\n![](figures/violentCrime.png){fig-align=\"center\"}\n\n---\n\n![](figures/College.png){fig-align=\"center\"}\n\n---\n\n![](figures/Wealth.png){fig-align=\"center\"}\n\n---\n\n**Summary Table**\n![](figures/feature_summary_table.png){fig-align=\"center\"}\n\n---\n\n**Justification:**\nThe features included were engineered to capture social, economic, and environmental factors influencing housing prices. Buffer-based and k nearest-neighbor measures quantify local accessibility and safety. Census data helps to enrich parcels with socio-economic context. Interaction terms account for neighborhood-level wealth which helps contextualize external features of a home, for instance homes in a wealthy neighborhood are more likely to have a higher property value than those in other neighborhood. Applying a binary indicator improves model interpretability and performance for the external condition of a property. The table above includes why each feature was chosen.\n\n---\n\n### Models\n**Census variables**\n![](figures/summary-1.png){fig-align=\"center\"}\n\n---\n\n**Census variables + Spatial features**\n![](figures/summary-2.png){fig-align=\"center\"}\n\n---\n\n**Census variables + Spatial features + Interactions and fixed effects**\n![](figures/summary-3.png){fig-align=\"center\"}\n\n---\n\n### Model Validation \nThe model started wiith an RMSE of 0.6076661, R squared of 0.35 and MAE of 0.4539476. This improved gradually with our final values being RMSE 0.4856623, R squared of 0.5850392 and MAE of 0.3442266.\n\n| Model | CV RMSE (log) | R² |\n|-------|---------------|-----|\n| Structural Only | 0.61 | 0.35 |\n| + Census | 0.50 | 0.57 |\n| + Spatial | 0.49 | 0.58 |\n| + Interactions/FE | 0.48 | 0.59 |\n\n\n---\n\n### Predicted vs Actual Sales\n![](figures/predict_vs_actual.png){fig-align=\"center\"}\n\n---\n\n**Which features matter the most:**\nThe features which matter the most are wealthy neighborhoods, log of livable areas, percentage with a bachelor's degree and percentage of poverty. The First three features have a positive effect while the percentage of poverty has a strong inverse effect.\n\n---\n\n### Model Diagnostics\n\n**Residual Plot**\n![](figures/residualplot.png){fig-align=\"center\"}\n\n---\n\n**Q-Q Plot**\n![](figures/q-qplot.png){fig-align=\"center\"}\n\n---\n\n**Cook's Distance**\n![](figures/cooksdistance.png){fig-align=\"center\"}\n\n---\n\n### Interpretation of plots\nThe Residuals vs Fitted plot is around 0 but slightly curved. This means that it could be missing a non-linear term. We tried accounting for this by squaring the age of the home. \n\nThe Q-Q Plot shows that the model roughly follows a normal distribution which means using a linear regression makes sense. Ultimately this provides more confidence in our model.\n\nCooks distance shows many spikes that are the same with a few all ones. A few tall spikes is not concerning as most of them are around the same height but the one on the right side of the graph could indicate a possible outlier that was not accounted for.\n\n---\n\n### Detailed Discussion\n\nThe final model explains approximately 59% of the variation in housing prices across Philadelphia, indicating a moderately strong fit. The Mean Absolute Error (MAE) of 0.34 suggests that the model’s predictions are off by about 34%. The RMSE score means that predictions are abou $154,200 off the true sale price. This level of accuracy is reasonable given the complexity and variability of the housing market. The most influential predictors of housing prices include wealthy neighborhoods, log of livable areas, percentage with a bachelor's degree, all of which have strong positive effects on property values. Conversely, the percentage of poverty and proximity to crime have strong negative relationships with home prices, underscoring how social perceptions of safety influence property values.\n\nNeighborhoods that are the hardest to predict tend to be those undergoing rapid change or instability, particularly areas experiencing gentrification, high prevalence of vacant and distressed properties or smaller sample areas. Examples of this are Nicetown, Fairhill, and Upper Kensington which are all located in North Philadelphia. In fact the top 10 locations which are the most hard to predict are all in North Philadelphia. Areas experiencing gentrification, rising educational attainment and declining crime rates occur alongside persistent vacancy and poverty, leading to non-linear effects that standard models struggle to account for. The rapid transformation in these neighborhoods contributes to greater residual errors. Thus, the model performs best in **mid-range markets** and is less stable in low-value areas. \n\nFrom an equity perspective, including socioeconomic indicators such as poverty and education levels improves predictive accuracy but also risks reproducing structural inequalities. By learning from historical patterns of disinvestment, the model may undervalue properties in low-income or historically marginalized neighborhoods. This raises ethical concerns when creating policy based on automated valuation models as it could inadvertently reinforce existing disparities. To mitigate this, residual analysis can be used to test for spatial bias, identifying neighborhoods where the model systematically under- or over-predicts values. Recognizing the limitations within the model highlights opportunities to inform equitable housing policy, such as directing investment initiatives or development funds toward historically undervalued areas rather than further harming them through biased valuation tools. Limitations while creating this model were not cleaning the data in a way that removed abnormalities such as homes that sold for a lot more than those nearby when looking at square footage and not including transportation data which would enrich our understanding of the property's spatial features.\n\n---\n","srcMarkdownNoYaml":"\n\n---\n\n### Choices for data cleaning \n\nBefore starting the analysis it is necessary to clean each of the datasets to remove anomalies like houses with no rooms. Although we were looking at residential properties we did not include apartment building as it assigned the sale price of each apartment as the sale price of the building so this was removed. Hence, we are left with homes which mean they will include rooms. We also removed residential locations with sale prices under 10000 or over 1000000 which are very low and high prices and isolated parcel data to data between 2023 and 2024. Census data cleaning involved removing data errors or incomplete fields and adding a column to reflect percentages. The Census data started off with 408 rows and ended with 383 after the cleaning choices.\nOther data that is also included is university and college locations, crime locations and neighborhood. These are cleaned in a later portion and involve transforming the coordinate reference system so that everything corresponds before filtering and re-categorizing data to help with interpretation \n\n---\n\n### Phase 2: Exploratory Data Analysis\n\n![](figures/phl_sale_price_distribution.png){fig-align=\"center\"}\n\nThe graph above shows the highest concentration of parcel sale prices is around\" $200,000. The histogram is right-skewed which means most sale prices are concentrated on the left side between zero and $375,000. In such a case the mean is generally greater than the median because the tail  on the right could inflate the mean. This affects the model's prediction for lower income homes. \n\n---\n\n### Geographic distribution\n\n![](figures/phl_sale_price_map.png){fig-align=\"center\"}\n\n---\n\n**Geographic distribution**\nThe geographic distribution of sale prices in Philadelphia shows that the most expensive sales were around Center City, North West Philadelphia and North East Philadelphia Airport.The lowest sales are in South and North Philadelphia. There is little transition from areas with a high sale price to areas with a low sale price.\n\n---\n\n### Price vs. structural features \n![](figures/phl_price_vs_area.png){fig-align=\"center\"}\n\nMost places have a total livable area under 3000 sq ft, by 4000 sq ft the number is very sparce. Since the maximum for sale price is capped at **$** 1,000,000 there is a hard stop at this point on the y-axis. The most common type of sale was between zero to $500,000 for 0 to 2000 total livable square feet.\n\n---\n\n![](figures/phl_price_vs_bathrooms.png){fig-align=\"center\"}\nWith respect to bathrooms the parcel that is sold the most contains 2 bathrooms and sales for under $812,500.\n\n---\n\n![](figures/phl_price_vs_bedrooms.png){fig-align=\"center\"}\n\nThe parcel that is sold the most contains 2 bathrooms and sales for under $750,000.\n\n---\n \n### Price vs. spatial features\n![](figures/phl_price_vs_college_distance.png){fig-align=\"center\"}\nThe Sale Price vs Distance to Nearest College Map shows that as parcels are further from colleges their sale price decreases slightly due to the slight negative slope of the line. \n\n---\n\n### Creative visualization\n![](figures/density map-1.png){fig-align=\"center\"}\nMost areas have 2 bedrooms but there are several pockets such as slightly North of Center City and West Philadelphia which have a higher number of bedrooms.\n\n---\n\n### Phase 3: Feature Engineering\n\n1. **Buffer-based features**:\n\n   - Violent Crimes within 600ft\n\n2. **k-Nearest Neighbor features**:\n\n   - Average distance from parcel to 1, 3, and 5 nearest colleges and university buildings. Code written above in order to map feature.\n   \n3. **Census variables**:\n\n   - Join median income, percentage with a bachelor's degree, and poverty percentage \n\n4. **Interaction terms**:\n\n   - Wealthy neighborhoods which take into account if a home is in a wealthy neighborhood which is based on median sale price.\n   \n5. **Other features**:\n\n   - log_sale_price, log_livable_area, age and exterior condition (if it is good or not)\n\n---\n\n### Interaction effects\n![](figures/violentCrime.png){fig-align=\"center\"}\n\n---\n\n![](figures/College.png){fig-align=\"center\"}\n\n---\n\n![](figures/Wealth.png){fig-align=\"center\"}\n\n---\n\n**Summary Table**\n![](figures/feature_summary_table.png){fig-align=\"center\"}\n\n---\n\n**Justification:**\nThe features included were engineered to capture social, economic, and environmental factors influencing housing prices. Buffer-based and k nearest-neighbor measures quantify local accessibility and safety. Census data helps to enrich parcels with socio-economic context. Interaction terms account for neighborhood-level wealth which helps contextualize external features of a home, for instance homes in a wealthy neighborhood are more likely to have a higher property value than those in other neighborhood. Applying a binary indicator improves model interpretability and performance for the external condition of a property. The table above includes why each feature was chosen.\n\n---\n\n### Models\n**Census variables**\n![](figures/summary-1.png){fig-align=\"center\"}\n\n---\n\n**Census variables + Spatial features**\n![](figures/summary-2.png){fig-align=\"center\"}\n\n---\n\n**Census variables + Spatial features + Interactions and fixed effects**\n![](figures/summary-3.png){fig-align=\"center\"}\n\n---\n\n### Model Validation \nThe model started wiith an RMSE of 0.6076661, R squared of 0.35 and MAE of 0.4539476. This improved gradually with our final values being RMSE 0.4856623, R squared of 0.5850392 and MAE of 0.3442266.\n\n| Model | CV RMSE (log) | R² |\n|-------|---------------|-----|\n| Structural Only | 0.61 | 0.35 |\n| + Census | 0.50 | 0.57 |\n| + Spatial | 0.49 | 0.58 |\n| + Interactions/FE | 0.48 | 0.59 |\n\n\n---\n\n### Predicted vs Actual Sales\n![](figures/predict_vs_actual.png){fig-align=\"center\"}\n\n---\n\n**Which features matter the most:**\nThe features which matter the most are wealthy neighborhoods, log of livable areas, percentage with a bachelor's degree and percentage of poverty. The First three features have a positive effect while the percentage of poverty has a strong inverse effect.\n\n---\n\n### Model Diagnostics\n\n**Residual Plot**\n![](figures/residualplot.png){fig-align=\"center\"}\n\n---\n\n**Q-Q Plot**\n![](figures/q-qplot.png){fig-align=\"center\"}\n\n---\n\n**Cook's Distance**\n![](figures/cooksdistance.png){fig-align=\"center\"}\n\n---\n\n### Interpretation of plots\nThe Residuals vs Fitted plot is around 0 but slightly curved. This means that it could be missing a non-linear term. We tried accounting for this by squaring the age of the home. \n\nThe Q-Q Plot shows that the model roughly follows a normal distribution which means using a linear regression makes sense. Ultimately this provides more confidence in our model.\n\nCooks distance shows many spikes that are the same with a few all ones. A few tall spikes is not concerning as most of them are around the same height but the one on the right side of the graph could indicate a possible outlier that was not accounted for.\n\n---\n\n### Detailed Discussion\n\nThe final model explains approximately 59% of the variation in housing prices across Philadelphia, indicating a moderately strong fit. The Mean Absolute Error (MAE) of 0.34 suggests that the model’s predictions are off by about 34%. The RMSE score means that predictions are abou $154,200 off the true sale price. This level of accuracy is reasonable given the complexity and variability of the housing market. The most influential predictors of housing prices include wealthy neighborhoods, log of livable areas, percentage with a bachelor's degree, all of which have strong positive effects on property values. Conversely, the percentage of poverty and proximity to crime have strong negative relationships with home prices, underscoring how social perceptions of safety influence property values.\n\nNeighborhoods that are the hardest to predict tend to be those undergoing rapid change or instability, particularly areas experiencing gentrification, high prevalence of vacant and distressed properties or smaller sample areas. Examples of this are Nicetown, Fairhill, and Upper Kensington which are all located in North Philadelphia. In fact the top 10 locations which are the most hard to predict are all in North Philadelphia. Areas experiencing gentrification, rising educational attainment and declining crime rates occur alongside persistent vacancy and poverty, leading to non-linear effects that standard models struggle to account for. The rapid transformation in these neighborhoods contributes to greater residual errors. Thus, the model performs best in **mid-range markets** and is less stable in low-value areas. \n\nFrom an equity perspective, including socioeconomic indicators such as poverty and education levels improves predictive accuracy but also risks reproducing structural inequalities. By learning from historical patterns of disinvestment, the model may undervalue properties in low-income or historically marginalized neighborhoods. This raises ethical concerns when creating policy based on automated valuation models as it could inadvertently reinforce existing disparities. To mitigate this, residual analysis can be used to test for spatial bias, identifying neighborhoods where the model systematically under- or over-predicts values. Recognizing the limitations within the model highlights opportunities to inform equitable housing policy, such as directing investment initiatives or development funds toward historically undervalued areas rather than further harming them through biased valuation tools. Limitations while creating this model were not cleaning the data in a way that removed abnormalities such as homes that sold for a lot more than those nearby when looking at square footage and not including transportation data which would enrich our understanding of the property's spatial features.\n\n---\n"},"formats":{"revealjs":{"identifier":{"display-name":"RevealJS","target-format":"revealjs","base-format":"revealjs"},"execute":{"fig-width":10,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":false,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"markdown"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","html-math-method":{"method":"mathjax","url":"https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js?config=TeX-AMS_HTML-full"},"slide-level":2,"to":"revealjs","output-file":"lab3.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":false,"quarto-version":"1.8.24","auto-stretch":true,"title":"Lab 3","subtitle":"Philadelphia Housing Price Prediction Improving Property Tax Assessments","author":"Ixchel Ramirez","theme":"simple","slideNumber":true,"smaller":true}}},"projectFormats":["html"]}