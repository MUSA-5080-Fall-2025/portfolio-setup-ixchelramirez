"0",""
"0","#used this for local_moran becuase when it saves fishnet as fishnet it aborts 2. dplyr mutate + sf can still corrupt the geometry column"
"0",""
"0","coords <- st_coordinates(st_centroid(fishnet))"
"0","neighbors <- knn2nb(knearneigh(coords, k = 5))"
"0","weights <- nb2listw(neighbors, style = ""W"", zero.policy = TRUE)"
"0",""
"0","local_moran <- localmoran(fishnet[[""streetLights_allOut""]], weights)"
"0","mean_val <- mean(fishnet[[""streetLights_allOut""]], na.rm = TRUE)"
"0",""
"0","fishnet$local_i <- local_moran[,1]"
"0","fishnet$p_value <- local_moran[,5]"
"0","fishnet$is_significant <- fishnet$p_value < 0.05"
"0",""
"0","mean_val <- mean(fishnet$streetLights_allOut, na.rm = TRUE)"
"0",""
"0","fishnet$moran_class <- dplyr::case_when("
"0","  !fishnet$is_significant ~ ""Not Significant"","
"0","  fishnet$local_i > 0 & fishnet$streetLights_allOut > mean_val ~ ""High-High"","
"0","  fishnet$local_i > 0 & fishnet$streetLights_allOut <= mean_val ~ ""Low-Low"","
"0","  fishnet$local_i < 0 & fishnet$streetLights_allOut > mean_val ~ ""High-Low"","
"0","  fishnet$local_i < 0 & fishnet$streetLights_allOut <= mean_val ~ ""Low-High"""
"0",")"
"0",""
"0",""
"0",""
"0",""
