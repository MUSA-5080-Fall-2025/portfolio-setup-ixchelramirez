"0",""
"0","# Create distribution visualization"
"0","### Map 2: Detailed Vulnerability Map (Robust Version)"
"0","tract_vuln <- tract_vuln %>% "
"0","  filter(!st_is_empty(geometry)) %>% "
"0","  st_make_valid()"
"0",""
"0","pa_counties_proj <- pa_counties_proj %>%"
"0","  filter(!st_is_empty(geometry)) %>%"
"0","  st_make_valid()"
"0",""
"0","hospitals_proj <- hospitals_proj %>%"
"0","  filter(!st_is_empty(geometry)) %>%"
"0","  st_make_valid()"
"0",""
"0","tracts_vulnerable_only <- tract_vuln %>% "
"0","  filter(vulnerable == TRUE) %>%"
"0","  st_as_sf()"
"0",""
"0","tracts_underserved <- tract_vuln %>% "
"0","  filter(underserved == TRUE) %>%"
"0","  st_as_sf()"
"0",""
"0",""
"0","st_is_valid(tracts_vulnerable_only) %>% table()"
"1",".
"
"1","TRUE "
"1","
"
"1"," 850 "
"1","
"
"0","tracts_vulnerable_only <- tracts_vulnerable_only %>%"
"0","  filter(!st_is_empty(geometry), !is.na(st_dimension(geometry)))"
"0","nrow(tracts_vulnerable_only)"
"1","[1]"
"1"," 850"
"1","
"
"0","sum(st_is_empty(tracts_vulnerable_only))"
"1","[1]"
"1"," 0"
"1","
"
"0","class(tracts_vulnerable_only)"
"1","[1]"
"1"," ""sf""        "
"1"," ""tbl_df""    "
"1"," ""tbl""       "
"1"," ""data.frame"""
"1","
"
"0","st_geometry(tracts_vulnerable_only)"
"1","Geometry set for 850 features "
"1","
"
"1","Geometry type: POINT
"
"1","Dimension:     XY
"
"1","Bounding box:  "
"1","xmin: 1207878 ymin: 155878.3 xmax: 2750201 ymax: 1032054"
"1","
"
"1","Projected CRS: NAD83 / Pennsylvania South (ftUS)
"
"1","First 5 geometries:
"
"0","#trial plot"
"0",""
"0","st_geometry(census_tracts)"
"1","Geometry set for 3445 features "
"1","
"
"1","Geometry type: MULTIPOLYGON
"
"1","Dimension:     XY
"
"1","Bounding box:  "
"1","xmin: -8963433 ymin: 4825308 xmax: -8314399 ymax: 5201489"
"1","
"
"1","Projected CRS: WGS 84 / Pseudo-Mercator
"
"1","First 5 geometries:
"
"0","tracts_vulnerable_only <- census_tracts %>%"
"0","  left_join(tracts_vulnerable_only %>% st_drop_geometry(), by = ""GEOID"") %>%"
"0","  filter(vulnerable == TRUE)"
"0",""
"0","#refinement"
"0","tracts_vulnerable_only <- tracts_vulnerable_only %>%"
"0","  mutate(category = case_when("
"0","    underserved == TRUE ~ ""Underserved"","
"0","    vulnerable == TRUE ~ ""Vulnerable"","
"0","    TRUE ~ ""Other"""
"0","  ))"
"0",""
"0",""
"0","ggplot() +"
"0","  geom_sf(data = pa_counties_proj, fill = ""grey95"", color = ""darkgrey"", size = 0.2) +"
"0","  geom_sf(data = tracts_vulnerable_only, aes(fill = category), color = NA, alpha = 0.7) +"
"0","  geom_sf(data = hospitals_proj, color = ""grey18"", fill = ""grey22"", shape = 21, size = 1) +"
"0","  scale_fill_manual("
"0","    values = c("
"0","      ""Underserved"" = ""red"","
"0","      ""Vulnerable"" = ""firebrick4"","
"0","      ""Other"" = ""grey90"""
"0","    ),"
"0","    name = ""Tract Category"""
"0","  ) +"
"0","  labs("
"0","    title = ""Underserved and Vulnerable Populations in Pennsylvania"","
"0","    subtitle = ""Census tracts with elderly + low-income residents more than 15 miles from a hospital"","
"0","    caption = ""Data: ACS 2022, Pennsylvania Hospitals"""
"0","  ) +"
"0","  theme_void() +"
"0","  theme("
"0","    plot.title = element_text(face = ""bold"", size = 16),"
"0","    plot.subtitle = element_text(size = 12),"
"0","    legend.position = ""bottom"","
"0","    legend.title = element_text(face = ""bold""),"
"0","    panel.grid = element_blank() "
"0","  )"
