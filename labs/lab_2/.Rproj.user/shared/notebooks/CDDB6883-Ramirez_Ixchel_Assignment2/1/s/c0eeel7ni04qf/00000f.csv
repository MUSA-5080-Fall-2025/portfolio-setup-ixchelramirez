"0","# Your spatial analysis"
"0",""
"0","school_buffers <- st_buffer(schools, dist = 1000)  # creates a 1000 ft safety zone around schools"
"0",""
"0","school_buffers <- school_buffers %>%"
"0","  rename(school_id = objectid) #rename the school ids so the columns have different names"
"0",""
"0","crime <- crime %>%"
"0","  rename(crime_id = objectid)"
"0","school_crime_counts <- st_join(school_buffers, crime, join = st_contains) %>%"
"0","  group_by(school_id, school_name) %>%  # Use unique school ID"
"0","  summarise("
"0","    n_crimes = n(),"
"0","    .groups = ""drop"""
"0","  )"
"0",""
"0","#including the coverage of the bike network in Philly"
"0","bike_in_buffers <- st_intersection(bikenetwork, school_buffers)"
"0",""
"0","bike_length_per_school <- bike_in_buffers %>%"
"0","  group_by(school_id, school_name) %>%"
"0","  summarise("
"0","    bike_length_ft = sum(st_length(geometry)),"
"0","    .groups = ""drop"""
"0","  )"
"0",""
"0","#Bringing all the data together"
"0","# Drop geometry for bike summary"
"0","bike_length_per_school_df <- bike_length_per_school %>%"
"0","  st_drop_geometry()"
"0",""
"0","# Now join safely"
"0","school_safety_summary <- school_crime_counts %>%"
"0","  left_join(bike_length_per_school_df, by = c(""school_id"", ""school_name"")) %>%"
"0","  mutate(bike_length_ft = ifelse(is.na(bike_length_ft), 0, bike_length_ft))"
"0",""
"0","#Map of findings"
"0","library(ggplot2)"
"0","library(scales)"
"0",""
"0","school_crime_counts_df <- st_drop_geometry(school_crime_counts)"
"0",""
"0","# Merge crime counts to school buffers for plotting"
"0","school_buffers_plot <- school_buffers %>%"
"0","  left_join(school_crime_counts_df, by = c(""school_id"", ""school_name""))"
"0",""
"0","school_buffers_plot <- school_buffers_plot %>%"
"0","  mutate(n_crimes = ifelse(is.na(n_crimes), 0, n_crimes))"
"0",""
"0","# Highlight variation (e.g., sqrt)"
"0","school_buffers_plot <- school_buffers_plot %>%"
"0","  mutate(n_crimes_sqrt = sqrt(n_crimes))"
"0",""
