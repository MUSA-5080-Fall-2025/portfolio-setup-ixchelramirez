"0","# Spatial join tracts to counties"
"0","pa_counties_proj <- st_transform(pa_counties, st_crs(tract_vuln))"
"0",""
"0","tracts_county <- st_join("
"0","  tract_vuln,"
"0","  pa_counties_proj %>% select(COUNTY_NAM),"
"0","  join = st_within"
"0",")"
"0",""
"0","# Aggregate statistics by county"
"0",""
"0","county_stats <- tracts_county %>%"
"0","  st_drop_geometry() %>%"
"0","  group_by(COUNTY_NAM) %>%"
"0","  summarise("
"0","    n_vulnerable_tracts = n(),"
"0","    n_underserved_tracts = sum(underserved, na.rm = TRUE),"
"0","    pct_underserved = 100 * n_underserved_tracts / n_vulnerable_tracts,"
"0","    avg_dist_miles = mean(dist_to_hospital_miles, na.rm = TRUE),"
"0","    total_vulnerable_pop = sum(pop_65plus, na.rm = TRUE)"
"0","  ) %>%"
"0","  arrange(desc(pct_underserved))"
"0",""
"0","top5_pct_underserved <- county_stats %>%"
"0","  slice_max(pct_underserved, n = 5) %>%"
"0","  select(COUNTY_NAM, pct_underserved, n_vulnerable_tracts, n_underserved_tracts)"
"0",""
"0","top5_pct_underserved"
