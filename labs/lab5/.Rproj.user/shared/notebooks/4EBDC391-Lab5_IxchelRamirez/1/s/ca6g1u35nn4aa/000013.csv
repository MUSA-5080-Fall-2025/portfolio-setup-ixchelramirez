"0","# Create sf object for stations"
"0","stations_sf <- indego %>%"
"0","  distinct(start_station, start_lat, start_lon) %>%"
"0","  filter(!is.na(start_lat), !is.na(start_lon)) %>%"
"0","  st_as_sf(coords = c(""start_lon"", ""start_lat""), crs = 4326)"
"0",""
"0","# Spatial join to get census tract for each station"
"0","stations_census <- st_join(stations_sf, philly_census, left = TRUE) %>%"
"0","  st_drop_geometry()"
"0",""
"0","# Look at the result - investigate whether all of the stations joined to census data -- according to the map above there are stations in non-residential tracts."
"0",""
"0","stations_for_map <- indego %>%"
"0","  distinct(start_station, start_lat, start_lon) %>%"
"0","  filter(!is.na(start_lat), !is.na(start_lon)) %>%"
"0","  left_join("
"0","    stations_census %>% select(start_station, Med_Inc),"
"0","    by = ""start_station"""
"0","  ) %>%"
"0","  mutate(has_census = !is.na(Med_Inc))"
"0",""
"0","# Add back to trip data"
"0","indego_census <- indego %>%"
"0","  left_join("
"0","    stations_census %>% "
"0","      select(start_station, Med_Inc, Percent_Taking_Transit, "
"0","             Percent_White, Total_Pop),"
"0","    by = ""start_station"""
"0","  )"
"0",""
"0",""
"0","# Prepare data for visualization"
"0","stations_for_map <- indego %>%"
"0","  distinct(start_station, start_lat, start_lon) %>%"
"0","  filter(!is.na(start_lat), !is.na(start_lon)) %>%"
"0","  left_join("
"0","    stations_census %>% select(start_station, Med_Inc),"
"0","    by = ""start_station"""
"0","  ) %>%"
"0","  mutate(has_census = !is.na(Med_Inc))"
"0",""
"0","# Create the map showing problem stations"
"0","ggplot() +"
"0","  geom_sf(data = philly_census, aes(fill = Med_Inc), color = ""white"", size = 0.1) +"
"0","  scale_fill_viridis("
"0","    option = ""viridis"","
"0","    name = ""Median\nIncome"","
"0","    labels = scales::dollar,"
"0","    na.value = ""grey90"""
"0","  ) +"
"0","  # Stations with census data (small grey dots)"
"0","  geom_point("
"0","    data = stations_for_map %>% filter(has_census),"
"0","    aes(x = start_lon, y = start_lat),"
"0","    color = ""grey30"", size = 1, alpha = 0.6"
"0","  ) +"
"0","  # Stations WITHOUT census data (red X marks the spot)"
"0","  geom_point("
"0","    data = stations_for_map %>% filter(!has_census),"
"0","    aes(x = start_lon, y = start_lat),"
"0","    color = ""red"", size = 1, shape = 4, stroke = 1.5"
"0","  ) +"
"0","  labs("
"0","    title = ""Philadelphia Median Household Income by Census Tract"","
"0","    subtitle = ""Indego stations shown (RED = no census data match)"","
"0","    caption = ""Red X marks indicate stations that didn't join to census tracts"""
"0","  ) +"
"0","  mapTheme"
