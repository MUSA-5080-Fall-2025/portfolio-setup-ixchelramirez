"0","study_panel_complete <- study_panel_complete %>%"
"0","  mutate("
"0","    date_only = as.Date(interval60),"
"0",""
"0","    # 1: Holiday itself (only for training)"
"0","    is_holiday = ifelse("
"0","      date_only %in% Q2_2025_holidays & week < first_test_week,"
"0","      1, 0"
"0","    ),"
"0",""
"0","    # 2: Pre-holiday day (only training)"
"0","    is_preholiday_day = ifelse("
"0","      (date_only + 1) %in% Q2_2025_holidays & week < first_test_week,"
"0","      1, 0"
"0","    ),"
"0",""
"0","    # 3: Holiday week indicator"
"0","    week_has_holiday = week(date_only) %in% week(Q2_2025_holidays),"
"0",""
"0","    is_holiday_week = ifelse("
"0","      week_has_holiday & week < first_test_week,"
"0","      1, 0"
"0","    ),"
"0",""
"0","    # 4: Continuous feature: days until next holiday"
"0","    #days_to_next_holiday = sapply("
"0","    #  date_only,"
"0","    #  function(x) {"
"0","    #    diffs <- as.numeric(Q2_2025_holidays - x)"
"0","   #     min(diffs[diffs >= 0], na.rm = TRUE)"
"0","    #  }"
"0","  #  ),"
"0",""
"0","    # Remove future leakage in test dataset"
"0","   # days_to_next_holiday = ifelse(week >= first_test_week, NA, days_to_next_holiday)"
"0","  )"
"0",""
"0","cat(""is_holiday:\n"")"
"1","is_holiday:
"
"0","print(table(study_panel_complete$is_holiday))"
"1","
"
"1","     0 "
"1","     1 "
"1","
"
"1","701184 "
"1"," 17928 "
"1","
"
"0","cat(""is_preholiday_day:\n"")"
"1","is_preholiday_day:
"
"0","print(table(study_panel_complete$is_preholiday_day))"
"1","
"
"1","     0 "
"1","     1 "
"1","
"
"1","700935 "
"1"," 18177 "
"1","
"
"0","cat(""is_holiday_week:\n"")"
"1","is_holiday_week:
"
"0","print(table(study_panel_complete$is_holiday_week))"
"1","
"
"1","     0 "
"1","     1 "
"1","
"
"1","563985 "
"1","155127 "
"1","
"
